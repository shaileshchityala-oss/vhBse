SELECT FisFo.Field4 AS company, Val([Field1]) AS entryno, Val([Field14]) AS buysell, FisFo.Field24 AS orderno, IIf((Left([Field7],1)='C' Or Left([Field7],1)='P'),[Field3] & '  ' & [Field4] & '  ' & Format([mdate],'ddmmmyyyy') & '  ' & [Field6] & '  ' & Left([Field7],2),[Field3] & '  ' & [Field4] & '  ' & Format([mdate],'ddmmmyyyy')) AS script, FisFo.Field3 AS instrumentname, IIf(IsNull([Field6]),'0',[Field6]) AS strikerate, IIf((Left([Field3],3)='FUT'),'F',Left([Field7],1)) AS cp, mdate, 'FIST-' & [Field12] AS Dealer, CDate([Field22]) AS entrydate, Val(IIf((Val([Field14])=1),Val([Field15]),(Val([Field15]))*-1)) AS Qty, Val([Field16]) AS Rate, False AS IsLiq, DateDiff('s',CDate('1-1-1980'),CDate([Field22])) AS lActivityTime, DateSerial(Year(CDate([Field22])),Month(CDate([Field22])),Day(CDate([Field22]))) AS entry_date, IIf((Val([Field14])=1),Val([Field15])*Val([Field16]),(Val([Field15])*Val([Field16]))*-1) AS Tot, 'FISTFOTEXT' AS FileFlag, [Field12] AS OrgDealer
FROM (SELECT CDate(IIf(len([Field5])=8,Left([Field5],1) & '/' & Mid([Field5],2,3) & '/' & Right([Field5],4),Left([Field5],2) & '/' & Mid([Field5],3,3) & '/' & Right([Field5],4))) AS mdate, * FROM FisFotrd WHERE DateSerial(Year(CDate([Field22])),Month(CDate([Field22])),Day(CDate([Field22]))) >= Date() and Field26 is Not Null)  AS FisFo LEFT JOIN (SELECT * FROM trading WHERE (((trading.entrydate)>=Date())))  AS fotrading ON (Val(FisFo.Field1)=fotrading.entryno) AND (FisFo.Field24=fotrading.orderno)
WHERE isnull(fotrading.entryno) And (DateDiff("s",CDate("1-1-1980"),CDate(FisFotrd.Field22))>=(Select  Val(Max([lActivityTime]) & "") From trading WHERE (((trading.entrydate)>=Date()))));
